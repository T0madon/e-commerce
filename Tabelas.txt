-- CREATE TABLES 

CREATE TABLE Pessoa (
    Cod_P INT PRIMARY KEY,
    Endereço VARCHAR(255) NOT NULL,
    Email VARCHAR(255) NOT NULL,
    Nome VARCHAR(255) NOT NULL
);

CREATE TABLE Fone (
    Cod_P INT NOT NULL,
    Fone VARCHAR(20) NOT NULL,
    CONSTRAINT pk_fone PRIMARY KEY (Cod_P, Fone),
    CONSTRAINT fk_fone FOREIGN KEY (Cod_P) REFERENCES Pessoa ON DELETE CASCADE
);

CREATE TABLE Cliente (
    Cod_P INT PRIMARY KEY,
    CPF VARCHAR(11) NOT NULL,
    Idade INT NOT NULL,
    CONSTRAINT fk_cliente FOREIGN KEY(Cod_P) REFERENCES Pessoa ON DELETE CASCADE
);

CREATE TABLE Vendedor (
    Cod_P INT PRIMARY KEY,
    CNPJ VARCHAR(14) NOT NULL,
    CONSTRAINT	fk_vendedor FOREIGN KEY(Cod_P) REFERENCES Pessoa ON DELETE CASCADE
);

CREATE TABLE Area_de_Venda (
    Cod_A INT PRIMARY KEY,
    Nome VARCHAR(255) NOT NULL,
    Descrição TEXT NOT NULL
);

CREATE TABLE Produto (
    Cod_Prod INT PRIMARY KEY,
    Nome VARCHAR(255) NOT NULL,
    Descrição TEXT NOT NULL
);

CREATE TABLE Venda (
    Nota INT PRIMARY KEY,
    Data DATE NOT NULL,
    Valor_Total INT NOT NULL,
    Quantidade_Total_de_Itens INT NOT NULL
);

CREATE TABLE Bairro (
    Cod_B INT PRIMARY KEY,
    Nome VARCHAR(255) NOT NULL
);

CREATE TABLE Cidade (
    Cod_C INT PRIMARY KEY,
    Nome VARCHAR(255) NOT NULL
);

CREATE TABLE Estado (
    UF VARCHAR(2) PRIMARY KEY,
    Nome VARCHAR(255) NOT NULL
);

CREATE TABLE Produto_do_Vendedor (
    Cod_P INT NOT NULL,
    Cod_Prod INT NOT NULL,
    Quantidade INT NOT NULL,
    Valor INT NOT NULL,
    CONSTRAINT pk_PDV PRIMARY KEY(Cod_P, Cod_Prod),
    CONSTRAINT fk_PDV_P FOREIGN KEY(Cod_P) REFERENCES Vendedor ON DELETE CASCADE,
    CONSTRAINT fk_PDV_Prod FOREIGN KEY(Cod_Prod) REFERENCES Produto ON DELETE CASCADE
);

CREATE TABLE Venda_Unica (
    Nota INT NOT NULL,
    Cod_Prod INT NOT NULL,
    Cod_P INT NOT NULL,
    Quantidade INT NOT NULL,
    Valor INT NOT NULL,
    CONSTRAINT pk_VU PRIMARY KEY(Nota, Cod_Prod, Cod_P),
    CONSTRAINT fk_VU_Nota FOREIGN KEY(Nota) REFERENCES Venda ON DELETE CASCADE,
    CONSTRAINT fk_VU_Prod FOREIGN KEY(Cod_Prod) REFERENCES Produto_do_Vendedor(Cod_Prod) ON DELETE CASCADE,
    CONSTRAINT fk_VU_P FOREIGN KEY(Cod_P) REFERENCES Produto_do_Vendedor(Cod_P) ON DELETE CASCADE
);

-- ALTER TABLES

ALTER TABLE Cidade
	ADD COLUMN UF VARCHAR(2) NOT NULL,
    ADD CONSTRAINT fk_Cidade_Estado FOREIGN KEY(UF) REFERENCES Estado ON DELETE RESTRICT;

ALTER TABLE Bairro
	ADD COLUMN Cod_C INT NOT NULL,
    ADD CONSTRAINT fk_Bairro_Cidade FOREIGN KEY(Cod_C) REFERENCES Cidade ON DELETE RESTRICT;

ALTER TABLE Pessoa
	ADD COLUMN Cod_B INT NOT NULL,
    ADD CONSTRAINT fk_Pessoa_Bairro FOREIGN KEY(Cod_B)	REFERENCES Bairro ON DELETE RESTRICT;
    
ALTER TABLE Vendedor
	ADD COLUMN Cod_A INT NOT NULL,
    ADD CONSTRAINT fk_Vendedor_Area FOREIGN KEY(Cod_A) REFERENCES Area_de_Venda ON DELETE RESTRICT;
    
ALTER TABLE Venda
	ADD COLUMN Cod_P INT NOT NULL,
    ADD CONSTRAINT fk_Venda_Cliente FOREIGN KEY(Cod_P) REFERENCES Cliente ON DELETE CASCADE;
    
ALTER TABLE Produto
	ADD COLUMN Cod_A INT NOT NULL,
    ADD CONSTRAINT fk_Produto_Area FOREIGN KEY(Cod_A) REFERENCES Area_de_Venda ON DELETE RESTRICT;
